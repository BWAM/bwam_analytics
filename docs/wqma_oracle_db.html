<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>BWAM Analytics - 2&nbsp; WQMA Oracle Data Warehouse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./analytical_data_store.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="site_libs/viz-1.8.2/viz.js"></script><link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="site_libs/grViz-binding-1.0.11/grViz.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./wqma_oracle_db.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">WQMA Oracle Data Warehouse</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">BWAM Analytics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/BWAM/bwam_analytics" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Landing Page</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wqma_oracle_db.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">WQMA Oracle Data Warehouse</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analytical_data_store.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Analytical Data Store</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_dictionary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Dictionary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"><span class="header-section-number">3</span> </a>
  <ul class="collapse">
<li>
<a href="#connecting-to-the-wqma-data-warehouse" id="toc-connecting-to-the-wqma-data-warehouse" class="nav-link" data-scroll-target="#connecting-to-the-wqma-data-warehouse"><span class="header-section-number">3.1</span> Connecting to the WQMA Data Warehouse</a>
  <ul class="collapse">
<li><a href="#install-nexus" id="toc-install-nexus" class="nav-link" data-scroll-target="#install-nexus"><span class="header-section-number">3.1.1</span> Install nexus</a></li>
  <li><a href="#get-connected" id="toc-get-connected" class="nav-link" data-scroll-target="#get-connected"><span class="header-section-number">3.1.2</span> Get Connected</a></li>
  <li><a href="#understanding-the-data-warehouse-structure" id="toc-understanding-the-data-warehouse-structure" class="nav-link" data-scroll-target="#understanding-the-data-warehouse-structure"><span class="header-section-number">3.1.3</span> Understanding the Data Warehouse Structure</a></li>
  <li><a href="#get-data" id="toc-get-data" class="nav-link" data-scroll-target="#get-data"><span class="header-section-number">3.1.4</span> Get Data</a></li>
  <li><a href="#example-queries" id="toc-example-queries" class="nav-link" data-scroll-target="#example-queries"><span class="header-section-number">3.1.5</span> Example Queries</a></li>
  </ul>
</li>
  <li>
<a href="#setup-oracle-odbc-connectionsec-odbc" id="toc-setup-oracle-odbc-connectionsec-odbc" class="nav-link" data-scroll-target="#setup-oracle-odbc-connectionsec-odbc"><span class="header-section-number">3.2</span> Setup Oracle ODBC Connection{sec-odbc}</a>
  <ul class="collapse">
<li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective"><span class="header-section-number">3.2.1</span> Objective</a></li>
  <li><a href="#what-is-an-odbc" id="toc-what-is-an-odbc" class="nav-link" data-scroll-target="#what-is-an-odbc"><span class="header-section-number">3.2.2</span> What is an ODBC?</a></li>
  <li><a href="#oracles-instant-client-odbc-driver" id="toc-oracles-instant-client-odbc-driver" class="nav-link" data-scroll-target="#oracles-instant-client-odbc-driver"><span class="header-section-number">3.2.3</span> Oracle’s Instant Client ODBC Driver</a></li>
  <li><a href="#procedure" id="toc-procedure" class="nav-link" data-scroll-target="#procedure"><span class="header-section-number">3.2.4</span> Procedure</a></li>
  <li><a href="#keyring-setup-optional" id="toc-keyring-setup-optional" class="nav-link" data-scroll-target="#keyring-setup-optional"><span class="header-section-number">3.2.5</span> Keyring Setup (Optional)</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/BWAM/bwam_analytics/edit/main/wqma_oracle_db.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/BWAM/bwam_analytics/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">WQMA Oracle Data Warehouse</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="section" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> </h1>
<section id="connecting-to-the-wqma-data-warehouse" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="connecting-to-the-wqma-data-warehouse">
<span class="header-section-number">3.1</span> Connecting to the WQMA Data Warehouse</h2>
<p>If you have not already, please setup an ODBC connection to the WQMA data warehouse following the instructions in the ODBC section.</p>
<section id="install-nexus" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="install-nexus">
<span class="header-section-number">3.1.1</span> Install nexus</h3>
<p>The <code>nexus</code> package is available on GitHub. To install packages from GitHub, first install the package, <code>pak</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"pak"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>pak</code> to install the <code>nexus</code> package from GitHub. The code below specifies the organization (“BWAM”) and the repository (“nexus”). If this fails, try the next code chunk.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pak/man/pak.html">pak</a></span><span class="op">(</span><span class="st">"BWAM/nexus"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If <strong>pak</strong> fails to install the package, try using <strong>devtools</strong> and <strong>gitcreds</strong>. The difficulty with this option is you must install a GitHub PAT. To setup a PAT, see <a href="https://usethis.r-lib.org/articles/git-credentials.html#get-a-personal-access-token-pat">Managing Git(Hub) Credentials</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span><span class="op">(</span></span>
<span>  repo <span class="op">=</span> <span class="st">"BWAM/nexus"</span>,</span>
<span>  auth_token <span class="op">=</span> <span class="fu">gitcreds</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gitcreds/man/gitcreds_get.html">gitcreds_get</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">password</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="get-connected" class="level3" data-number="3.1.2"><h3 data-number="3.1.2" class="anchored" data-anchor-id="get-connected">
<span class="header-section-number">3.1.2</span> Get Connected</h3>
<p>To work with the data warehouse, you must first connect to it. This is very similar to specifying specifying a file directory containing multiple CSV files you want to import into R. <code>nexus</code> provides the function, <code>get_connected()</code>, to simplify the process for connecting to the data warehouse. At a minimum, you must provide your data warehouse username. You will be prompted to enter your password in a pop-up window. You should never supply your password in plain text because it increases the chances you accidentally share your password with others. For example, it is very easy to accidentally share your password when committing and pushing other changes to GitHub.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>When you are finished querying the data warehouse, please use
`DBI::dbDisconnect(conn = insert-your-connection-name-here)`.
This message is displayed once per session.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_connected.html">get_connected</a></span><span class="op">(</span>username <span class="op">=</span> <span class="st">"ZSMITH"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="understanding-the-data-warehouse-structure" class="level3" data-number="3.1.3"><h3 data-number="3.1.3" class="anchored" data-anchor-id="understanding-the-data-warehouse-structure">
<span class="header-section-number">3.1.3</span> Understanding the Data Warehouse Structure</h3>
<p>A primary goal of the WQMA Data Warehouse and <strong>nexus</strong> is to allow users to focus on the task at hand and <strong>NOT</strong> have to spend much energy cleaning data or learning how tables relate to one another. This section outlines a number of functions that can be used to rapidly learn about the data warehouse and it’s contents.</p>
<section id="tables-and-columns-and-definitions-oh-my" class="level4" data-number="3.1.3.1"><h4 data-number="3.1.3.1" class="anchored" data-anchor-id="tables-and-columns-and-definitions-oh-my">
<span class="header-section-number">3.1.3.1</span> Tables and Columns and Definitions, Oh My!</h4>
<p>The <strong>DBI</strong> function, <code>dbListTables()</code>, can be used to get a vector of tables in a database. For the WQMA data warehouse, we also need to specify the name of the schema we want to explore.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DBI/man/dbListTables.html">dbListTables</a></span><span class="op">(</span><span class="va">con</span>, schema_name <span class="op">=</span> <span class="st">"WQMA_OWNER"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "TAXONOMY_REFERENCE_JUNCTION" "PARAMETER"                  
 [3] "SITE"                        "TAXONOMIC_TRAIT"            
 [5] "SAMPLE_DELIVERY_GROUP"       "BASIN"                      
 [7] "RESULT"                      "ACCESSIONS_TABLES"          
 [9] "ACCESSIONS_DATA_MAP"         "PREVIOUS_TAXON_NAME"        
[11] "QUALITY_CONTROL"             "PROJECT"                    
[13] "PREVIOUS_SITE_ID"            "ACCESSIONS_FLD_XFM"         
[15] "EVENT"                       "SAMPLE"                     
[17] "WATERBODY"                   "ACCESSIONS_CDE_MAP"         
[19] "TAXONOMY_REFERENCE"          "ACCESSIONS"                 
[21] "RESULT_QUALIFIER"            "TAXONOMIC_ABUNDANCE"        
[23] "PARAMETER_NAME"              "TAXONOMY"                   
[25] "ACCESSIONS_KEY_MAP"         </code></pre>
</div>
</div>
<p>However, it is recommended that you use the <strong>nexus</strong> <code>get_data_dictionary()</code> function because it provides much more information than <code>dbListTables()</code>. Setting the argument <code>just_tables = TRUE</code> will return <a href="https://tibble.tidyverse.org/">tibble</a> (i.e., a fancy data frame) of all tables in the data warehouse and their definitions.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">dictionary</span> <span class="op">&lt;-</span> <span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_data_dictionary.html">get_data_dictionary</a></span><span class="op">(</span>just_tables <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 2
   table_name                  definition                                       
   &lt;chr&gt;                       &lt;chr&gt;                                            
 1 BASIN                       This table represents the 17 major drainage basi…
 2 EVENT                       A table representing all distinct sampling event…
 3 PARAMETER                   This table represents the distinct parameters pr…
 4 PARAMETER_NAME              This table provides descriptions of the paramete…
 5 PREVIOUS_SITE_ID            This table represents site IDs that were previou…
 6 PREVIOUS_TAXON_NAME         This table represents taxonomic names that were …
 7 PROJECT                     This table represents the monitoring projects th…
 8 QUALITY_CONTROL             This table contains quality control results asso…
 9 RESULT                      This table represents numeric and/or categorical…
10 RESULT_QUALIFIER            The table provides a detailed description of res…
11 SAMPLE                      This table represents distinct samples collected…
12 SAMPLE_DELIVERY_GROUP       A table containing all valid Sample Delivery Gro…
13 SITE                        This table represents the distinct monitoring lo…
14 TAXONOMIC_ABUNDANCE         This table contains taxonomic abundances— the co…
15 TAXONOMIC_TRAIT             This table represents taxonomic traits, such as …
16 TAXONOMY                    This table represents the tax's observed in New …
17 TAXONOMY_REFERENCE          This table identifies taxonomic reference materi…
18 TAXONOMY_REFERENCE_JUNCTION This is a junction table to facilitate the relat…
19 WATERBODY                   This table represents waterbodies in New York St…</code></pre>
</div>
</div>
<p>Running <code>get_data_dictionary()</code> with all the default arguments will return all table and column definitions in the data warehouse.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">dictionary</span> <span class="op">&lt;-</span> <span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_data_dictionary.html">get_data_dictionary</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 218 × 11
   table_name column_name    examples   definition  db_data_type character_limit
   &lt;chr&gt;      &lt;chr&gt;          &lt;list&gt;     &lt;chr&gt;       &lt;chr&gt;                  &lt;dbl&gt;
 1 BASIN      BASIN          &lt;chr [17]&gt; A unique 2… NUMBER                    NA
 2 BASIN      BASIN_NAME     &lt;chr [17]&gt; The names … VARCHAR2(50)              50
 3 BASIN      &lt;NA&gt;           &lt;NULL&gt;     This table… &lt;NA&gt;                      NA
 4 EVENT      EVENT_DATETIME &lt;chr [4]&gt;  The date a… DATETIME                  NA
 5 EVENT      EVENT_ID       &lt;chr [10]&gt; A unique s… VARCHAR2(50)              50
 6 EVENT      PROJECT        &lt;chr [10]&gt; A monitori… VARCHAR2(10…             100
 7 EVENT      QAPP_ID        &lt;chr [5]&gt;  The Qualit… VARCHAR2(50)              50
 8 EVENT      SITE_ID        &lt;dbl [10]&gt; A unique s… NUMBER                    NA
 9 EVENT      &lt;NA&gt;           &lt;NULL&gt;     A table re… &lt;NA&gt;                      NA
10 PARAMETER  CASRN          &lt;chr [10]&gt; A CAS Regi… VARCHAR2(50)              50
# ℹ 208 more rows
# ℹ 5 more variables: not_null &lt;lgl&gt;, surrogate_key &lt;lgl&gt;, primary_key &lt;chr&gt;,
#   foreign_key &lt;chr&gt;, parent_table &lt;chr&gt;</code></pre>
</div>
</div>
<p>The dictionary contains an <code>examples</code> field that provides examples of the type of data contained in each column. If there are less than 20 unique values in a column, all possible values are shown. For example, you can see all of the possible values for <code>WATERBODY_TYPE</code> using the following code:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dictionary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">table_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"WATERBODY"</span>,</span>
<span>                <span class="va">column_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"WATERBODY_TYPE"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/pull.html">pull</a></span><span class="op">(</span><span class="va">examples</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "lake"         "river_stream" "other"        "outfall"     </code></pre>
</div>
</div>
<p>You can supply a character vector of table names to the argument <code>table_vec</code> to subset the tibble to only the table or tables of interest. The example below, only shows the definitions for the <strong>BASIN</strong> and <strong>WATERBODY</strong> tables.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">dictionary</span> <span class="op">&lt;-</span> <span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_data_dictionary.html">get_data_dictionary</a></span><span class="op">(</span>table_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BASIN"</span>,</span>
<span>                                                        <span class="st">"WATERBODY"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 11
   table_name column_name       examples definition db_data_type character_limit
   &lt;chr&gt;      &lt;chr&gt;             &lt;list&gt;   &lt;chr&gt;      &lt;chr&gt;                  &lt;dbl&gt;
 1 BASIN      BASIN             &lt;chr&gt;    A unique … NUMBER                    NA
 2 BASIN      BASIN_NAME        &lt;chr&gt;    The names… VARCHAR2(50)              50
 3 BASIN      &lt;NA&gt;              &lt;NULL&gt;   This tabl… &lt;NA&gt;                      NA
 4 WATERBODY  WATERBODY_CODE    &lt;chr&gt;    A unique … VARCHAR2(50)              50
 5 WATERBODY  BEACH_PRESENT     &lt;chr&gt;    Identifie… VARCHAR2(15)              15
 6 WATERBODY  FISHERIES_INDEX_… &lt;chr&gt;    This is a… VARCHAR2(75)              75
 7 WATERBODY  PUBLIC_WATER_SUP… &lt;chr&gt;    Identifie… VARCHAR2(15)              15
 8 WATERBODY  USGS_POND_NUMBER  &lt;chr&gt;    A unique … VARCHAR2(15)              15
 9 WATERBODY  WATERBODY_ALTERN… &lt;chr&gt;    Some wate… VARCHAR2(10…             100
10 WATERBODY  WATERBODY_NAME    &lt;chr&gt;    The name … VARCHAR2(10…             100
11 WATERBODY  WATERBODY_TYPE    &lt;chr&gt;    Inidicate… VARCHAR2(50)              50
12 WATERBODY  &lt;NA&gt;              &lt;NULL&gt;   This tabl… &lt;NA&gt;                      NA
# ℹ 5 more variables: not_null &lt;lgl&gt;, surrogate_key &lt;lgl&gt;, primary_key &lt;chr&gt;,
#   foreign_key &lt;chr&gt;, parent_table &lt;chr&gt;</code></pre>
</div>
</div>
<p>Similar to <code>table_vec</code>, you can supply a character vector of column names to the argument <code>column_vec</code> to subset the tibble to only the column or columns of interest. This is useful for:</p>
<ol type="1">
<li><p>Getting the definition of a column(s) of interest.</p></li>
<li><p>Quickly identifying which table a column comes from.</p></li>
</ol>
<p>The example below shows the definitions for two columns of interest from two different tables.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">dictionary</span> <span class="op">&lt;-</span> <span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_data_dictionary.html">get_data_dictionary</a></span><span class="op">(</span></span>
<span>  column_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BASIN_NAME"</span>,</span>
<span>                 <span class="st">"WATERBODY_NAME"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 11
  table_name column_name    examples   definition   db_data_type character_limit
  &lt;chr&gt;      &lt;chr&gt;          &lt;list&gt;     &lt;chr&gt;        &lt;chr&gt;                  &lt;dbl&gt;
1 BASIN      BASIN_NAME     &lt;chr [17]&gt; The names o… VARCHAR2(50)              50
2 WATERBODY  WATERBODY_NAME &lt;chr [10]&gt; The name of… VARCHAR2(10…             100
# ℹ 5 more variables: not_null &lt;lgl&gt;, surrogate_key &lt;lgl&gt;, primary_key &lt;chr&gt;,
#   foreign_key &lt;chr&gt;, parent_table &lt;chr&gt;</code></pre>
</div>
</div>
</section></section><section id="get-data" class="level3" data-number="3.1.4"><h3 data-number="3.1.4" class="anchored" data-anchor-id="get-data">
<span class="header-section-number">3.1.4</span> Get Data</h3>
<section id="single-table-queries" class="level4" data-number="3.1.4.1"><h4 data-number="3.1.4.1" class="anchored" data-anchor-id="single-table-queries">
<span class="header-section-number">3.1.4.1</span> Single Table Queries</h4>
<p>To query data from a single table you can use functions from the <strong>dplyr</strong> and <strong>DBI</strong> packages. Below I have established a remote connection to the <em>BASIN</em> table in the data warehouse. I have not yet pulled the data into R. You may think of this as a preview of the data that you will pull into R. As you can see, you need to provide a connection to a database, the schema, and the table name.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">basin_tbl</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/tbl.html">tbl</a></span><span class="op">(</span><span class="va">con</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="st">"WQMA_OWNER.BASIN"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   table&lt;WQMA_OWNER.BASIN&gt; [?? x 6]
# Database: Oracle 19.00.0000[ZSMITH@WQMAP/]
   BASIN BASIN_NAME  CREATE_DATE         END_DATE UPDATE_DATE
   &lt;chr&gt; &lt;chr&gt;       &lt;dttm&gt;              &lt;dttm&gt;   &lt;dttm&gt;     
 1 01    Lake Erie-… 2024-03-26 13:32:45 NA       NA         
 2 02    Allegheny … 2024-03-26 13:32:45 NA       NA         
 3 03    Lake Ontar… 2024-03-26 13:32:45 NA       NA         
 4 04    Genesee Ri… 2024-03-26 13:32:45 NA       NA         
 5 05    Chemung Ri… 2024-03-26 13:32:45 NA       NA         
 6 06    Susquehann… 2024-03-26 13:32:45 NA       NA         
 7 07    Seneca-One… 2024-03-26 13:32:45 NA       NA         
 8 08    Black Rive… 2024-03-26 13:32:45 NA       NA         
 9 09    St. Lawren… 2024-03-26 13:32:45 NA       NA         
10 10    Lake Champ… 2024-03-26 13:32:45 NA       NA         
# ℹ more rows
# ℹ 1 more variable: UPDATED_BY_GUID &lt;chr&gt;</code></pre>
</div>
</div>
<p>To bring the data into R, you need to use the <strong>dplyr</strong> function, <code>collect()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">basin_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="va">basin_tbl</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 6
   BASIN BASIN_NAME  CREATE_DATE         END_DATE UPDATE_DATE
   &lt;chr&gt; &lt;chr&gt;       &lt;dttm&gt;              &lt;dttm&gt;   &lt;dttm&gt;     
 1 01    Lake Erie-… 2024-03-26 13:32:45 NA       NA         
 2 02    Allegheny … 2024-03-26 13:32:45 NA       NA         
 3 03    Lake Ontar… 2024-03-26 13:32:45 NA       NA         
 4 04    Genesee Ri… 2024-03-26 13:32:45 NA       NA         
 5 05    Chemung Ri… 2024-03-26 13:32:45 NA       NA         
 6 06    Susquehann… 2024-03-26 13:32:45 NA       NA         
 7 07    Seneca-One… 2024-03-26 13:32:45 NA       NA         
 8 08    Black Rive… 2024-03-26 13:32:45 NA       NA         
 9 09    St. Lawren… 2024-03-26 13:32:45 NA       NA         
10 10    Lake Champ… 2024-03-26 13:32:45 NA       NA         
11 11    Upper Huds… 2024-03-26 13:32:45 NA       NA         
12 12    Mohawk Riv… 2024-03-26 13:32:45 NA       NA         
13 13    Lower Huds… 2024-03-26 13:32:45 NA       NA         
14 14    Delaware R… 2024-03-26 13:32:45 NA       NA         
15 15    Passaic-Ne… 2024-03-26 13:32:45 NA       NA         
16 17    Atlantic O… 2024-03-26 13:32:45 NA       NA         
17 16    Housatonic… 2024-03-26 13:32:45 NA       NA         
# ℹ 1 more variable: UPDATED_BY_GUID &lt;chr&gt;</code></pre>
</div>
</div>
<p>You can use <strong>dplyr</strong> functions to work with the data in the database. <strong>dplyr</strong> will translate these functions to SQL for you.</p>
<p>This example: 1. Uses the <code>basin_tbl</code> connection established before 2. Filters the <code>BASIN</code> column to the rows that represent the major drainage basins “03” and “07” 3. Retains only the <code>BASIN_NAME</code> column 4. Collects the data from the database and into R.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1</span></span>
<span><span class="va">basin_tbl</span> <span class="op">|&gt;</span> </span>
<span><span class="co"># 2</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">BASIN</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"03"</span>, <span class="st">"07"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="co"># 3</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">BASIN_NAME</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="co"># 4</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 1
  BASIN_NAME                      
  &lt;chr&gt;                           
1 Lake Ontario &amp; Minor Tribs.     
2 Seneca-Oneida-Oswego River Basin</code></pre>
</div>
</div>
<p>This example: 1. Connects to the “EVENT” table 2. filters to the rows were the <code>EVENT_DATETIME</code> column to only the events that occurred between July 1-7th of 2022. 3. Collects the data from the database and into R.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/tbl.html">tbl</a></span><span class="op">(</span><span class="va">con</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="st">"WQMA_OWNER.EVENT"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="co"># 2</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/between.html">between</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">EVENT_DATETIME</span>,</span>
<span>      left <span class="op">=</span> <span class="fu">to_date</span><span class="op">(</span><span class="st">"2022-07-01"</span>, <span class="st">"YYYY-MM-DD HH24:MI:SS"</span><span class="op">)</span>,</span>
<span>      right <span class="op">=</span> <span class="fu">to_date</span><span class="op">(</span><span class="st">"2022-07-07"</span>, <span class="st">"YYYY-MM-DD HH24:MI:SS"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="co"># 3</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 215 × 9
   EVENT_ID      EVENT_DATETIME      SITE_ID PROJECT QAPP_ID CREATE_DATE        
   &lt;chr&gt;         &lt;dttm&gt;                &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dttm&gt;             
 1 13-FDRY-0.4_… 2022-07-06 09:15:00   27578 Undefi… Unknown 2024-03-26 14:26:14
 2 13-STNY-0.8_… 2022-07-06 15:00:00   28025 Undefi… Unknown 2024-03-26 14:26:14
 3 13-STNY-0.8_… 2022-07-05 15:00:00   28025 Undefi… Unknown 2024-03-26 14:26:14
 4 13-GUNK-40.3… 2022-07-05 13:15:00   27611 PWS pr… Unknown 2024-03-26 14:26:11
 5 13-WKLEI_T4-… 2022-07-05 15:30:00   28182 PWS pr… Unknown 2024-03-26 14:26:11
 6 14-COUL-0.9_… 2022-07-05 10:00:00   28349 PWS pr… Unknown 2024-03-26 14:26:11
 7 07-SXML-2.2_… 2022-07-06 11:45:00   25790 PWS pr… Unknown 2024-03-26 14:26:11
 8 07-SXML-8.0_… 2022-07-06 10:30:00   25791 PWS pr… Unknown 2024-03-26 14:26:11
 9 07-SXML-12.4… 2022-07-06 09:15:00   25789 PWS pr… Unknown 2024-03-26 14:26:11
10 13-CRUM-1.5_… 2022-07-06 11:00:00   27545 PWS pr… Unknown 2024-03-26 14:26:11
# ℹ 205 more rows
# ℹ 3 more variables: END_DATE &lt;dttm&gt;, UPDATE_DATE &lt;dttm&gt;,
#   UPDATED_BY_GUID &lt;chr&gt;</code></pre>
</div>
</div>
</section><section id="multiple-table-queries-or-operating-on-the-data-model" class="level4" data-number="3.1.4.2"><h4 data-number="3.1.4.2" class="anchored" data-anchor-id="multiple-table-queries-or-operating-on-the-data-model">
<span class="header-section-number">3.1.4.2</span> Multiple Table Queries (Or Operating on the Data Model)</h4>
<p>In most situations, it is recommended that you acquire data using the <code>get_data_model()</code> function from <strong>nexus</strong>. This function has been tailored to connect to establish a remote connection to each table in the data warehouse and define the relationships between tables.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">data_model</span> <span class="op">&lt;-</span> <span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_data_model.html">get_data_model</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">con</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>── Table source ────────────────────────────────────────────────────────────────
src:  Oracle 19.00.0000[ZSMITH@WQMAP/]
── Metadata ────────────────────────────────────────────────────────────────────
Tables: `BASIN`, `EVENT`, `PARAMETER`, `PARAMETER_NAME`, `PREVIOUS_SITE_ID`, … (19 total)
Columns: 200
Primary keys: 13
Foreign keys: 18</code></pre>
</div>
</div>
<p>We can visualize the table relationships with the <code>get_erd()</code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_erd.html">get_erd</a></span><span class="op">(</span><span class="va">data_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-1a3858c2ca5cf2c705cd" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1a3858c2ca5cf2c705cd">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"BASIN\" [id = \"BASIN\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#5E7988AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#8DB6CDFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">BASIN<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E8F0F5FF\" PORT=\"BASIN\"><U>BASIN<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"EVENT\" [id = \"EVENT\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00595CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00868BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">EVENT<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE6E7FF\" PORT=\"EVENT_ID\"><U>EVENT_ID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE6E7FF\" PORT=\"SITE_ID\">SITE_ID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE6E7FF\" PORT=\"PROJECT\">PROJECT<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"PARAMETER\" [id = \"PARAMETER\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#759599AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#B0E0E6FF\" BORDER=\"0\"><FONT COLOR=\"#000000\">PARAMETER<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#EFF8FAFF\" PORT=\"PARAMETER_ID\"><U>PARAMETER_ID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#EFF8FAFF\" PORT=\"PARAMETER_NAME\">PARAMETER_NAME<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"PARAMETER_NAME\" [id = \"PARAMETER_NAME\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#759599AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#B0E0E6FF\" BORDER=\"0\"><FONT COLOR=\"#000000\">PARAMETER_NAME<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#EFF8FAFF\" PORT=\"PARAMETER_NAME\"><U>PARAMETER_NAME<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"PREVIOUS_SITE_ID\" [id = \"PREVIOUS_SITE_ID\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#5E7988AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#8DB6CDFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">PREVIOUS_SITE_ID<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E8F0F5FF\" PORT=\"SITE_ID\">SITE_ID<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"PREVIOUS_TAXON_NAME\" [id = \"PREVIOUS_TAXON_NAME\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#448871AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#66CDAAFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">PREVIOUS_TAXON_NAME<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"TAXON_ID\">TAXON_ID<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"PROJECT\" [id = \"PROJECT\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00595CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00868BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">PROJECT<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE6E7FF\" PORT=\"PROJECT\"><U>PROJECT<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"QUALITY_CONTROL\" [id = \"QUALITY_CONTROL\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#909090AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#D9D9D9FF\" BORDER=\"0\"><FONT COLOR=\"#000000\">QUALITY_CONTROL<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#F7F7F7FF\" PORT=\"SAMPLE_DELIVERY_GROUP\">SAMPLE_DELIVERY_GROUP<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"RESULT\" [id = \"RESULT\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#759599AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#B0E0E6FF\" BORDER=\"0\"><FONT COLOR=\"#000000\">RESULT<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#EFF8FAFF\" PORT=\"PARAMETER_ID\">PARAMETER_ID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#EFF8FAFF\" PORT=\"SAMPLE_ID\">SAMPLE_ID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#EFF8FAFF\" PORT=\"RESULT_QUALIFIER\">RESULT_QUALIFIER<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"RESULT_QUALIFIER\" [id = \"RESULT_QUALIFIER\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#759599AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#B0E0E6FF\" BORDER=\"0\"><FONT COLOR=\"#000000\">RESULT_QUALIFIER<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#EFF8FAFF\" PORT=\"RESULT_QUALIFIER\"><U>RESULT_QUALIFIER<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"SAMPLE\" [id = \"SAMPLE\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#531988AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#7D26CDFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">SAMPLE<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E5D3F5FF\" PORT=\"SAMPLE_ID\"><U>SAMPLE_ID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E5D3F5FF\" PORT=\"EVENT_ID\">EVENT_ID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E5D3F5FF\" PORT=\"SAMPLE_DELIVERY_GROUP\">SAMPLE_DELIVERY_GROUP<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"SAMPLE_DELIVERY_GROUP\" [id = \"SAMPLE_DELIVERY_GROUP\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#909090AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#D9D9D9FF\" BORDER=\"0\"><FONT COLOR=\"#000000\">SAMPLE_DELIVERY_GROUP<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#F7F7F7FF\" PORT=\"SAMPLE_DELIVERY_GROUP\"><U>SAMPLE_DELIVERY_GROUP<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"SITE\" [id = \"SITE\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#5E7988AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#8DB6CDFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">SITE<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E8F0F5FF\" PORT=\"SITE_ID\"><U>SITE_ID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E8F0F5FF\" PORT=\"BASIN\">BASIN<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E8F0F5FF\" PORT=\"WATERBODY_CODE\">WATERBODY_CODE<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"TAXONOMIC_ABUNDANCE\" [id = \"TAXONOMIC_ABUNDANCE\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#448871AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#66CDAAFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">TAXONOMIC_ABUNDANCE<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"SAMPLE_ID\">SAMPLE_ID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"TAXON_ID\">TAXON_ID<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"TAXONOMIC_TRAIT\" [id = \"TAXONOMIC_TRAIT\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#448871AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#66CDAAFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">TAXONOMIC_TRAIT<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"TAXON_ID\">TAXON_ID<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"TAXONOMY\" [id = \"TAXONOMY\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#448871AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#66CDAAFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">TAXONOMY<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"TAXON_ID\"><U>TAXON_ID<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"TAXONOMY_REFERENCE\" [id = \"TAXONOMY_REFERENCE\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#448871AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#66CDAAFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">TAXONOMY_REFERENCE<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"REFERENCE_ID\"><U>REFERENCE_ID<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"TAXONOMY_REFERENCE_JUNCTION\" [id = \"TAXONOMY_REFERENCE_JUNCTION\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#448871AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#66CDAAFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">TAXONOMY_REFERENCE_JUNCTION<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"REFERENCE_ID\">REFERENCE_ID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E0F5EEFF\" PORT=\"TAXON_ID\"><U>TAXON_ID<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"WATERBODY\" [id = \"WATERBODY\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#5E7988AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#8DB6CDFF\" BORDER=\"0\"><FONT COLOR=\"#000000\">WATERBODY<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#E8F0F5FF\" PORT=\"WATERBODY_CODE\"><U>WATERBODY_CODE<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"SITE\":\"BASIN\"->\"BASIN\":\"BASIN\" [id=\"SITE_1\"]\n\"SAMPLE\":\"EVENT_ID\"->\"EVENT\":\"EVENT_ID\" [id=\"SAMPLE_1\"]\n\"RESULT\":\"PARAMETER_ID\"->\"PARAMETER\":\"PARAMETER_ID\" [id=\"RESULT_1\"]\n\"PARAMETER\":\"PARAMETER_NAME\"->\"PARAMETER_NAME\":\"PARAMETER_NAME\" [id=\"PARAMETER_1\"]\n\"EVENT\":\"PROJECT\"->\"PROJECT\":\"PROJECT\" [id=\"EVENT_1\"]\n\"RESULT\":\"RESULT_QUALIFIER\"->\"RESULT_QUALIFIER\":\"RESULT_QUALIFIER\" [id=\"RESULT_2\"]\n\"TAXONOMIC_ABUNDANCE\":\"SAMPLE_ID\"->\"SAMPLE\":\"SAMPLE_ID\" [id=\"TAXONOMIC_ABUNDANCE_1\"]\n\"RESULT\":\"SAMPLE_ID\"->\"SAMPLE\":\"SAMPLE_ID\" [id=\"RESULT_3\"]\n\"SAMPLE\":\"SAMPLE_DELIVERY_GROUP\"->\"SAMPLE_DELIVERY_GROUP\":\"SAMPLE_DELIVERY_GROUP\" [id=\"SAMPLE_2\"]\n\"QUALITY_CONTROL\":\"SAMPLE_DELIVERY_GROUP\"->\"SAMPLE_DELIVERY_GROUP\":\"SAMPLE_DELIVERY_GROUP\" [id=\"QUALITY_CONTROL_1\"]\n\"PREVIOUS_SITE_ID\":\"SITE_ID\"->\"SITE\":\"SITE_ID\" [id=\"PREVIOUS_SITE_ID_1\"]\n\"EVENT\":\"SITE_ID\"->\"SITE\":\"SITE_ID\" [id=\"EVENT_2\"]\n\"PREVIOUS_TAXON_NAME\":\"TAXON_ID\"->\"TAXONOMY\":\"TAXON_ID\" [id=\"PREVIOUS_TAXON_NAME_1\"]\n\"TAXONOMIC_TRAIT\":\"TAXON_ID\"->\"TAXONOMY\":\"TAXON_ID\" [id=\"TAXONOMIC_TRAIT_1\"]\n\"TAXONOMY_REFERENCE_JUNCTION\":\"TAXON_ID\"->\"TAXONOMY\":\"TAXON_ID\" [id=\"TAXONOMY_REFERENCE_JUNCTION_1\"]\n\"TAXONOMIC_ABUNDANCE\":\"TAXON_ID\"->\"TAXONOMY\":\"TAXON_ID\" [id=\"TAXONOMIC_ABUNDANCE_2\"]\n\"TAXONOMY_REFERENCE_JUNCTION\":\"REFERENCE_ID\"->\"TAXONOMY_REFERENCE\":\"REFERENCE_ID\" [id=\"TAXONOMY_REFERENCE_JUNCTION_2\"]\n\"SITE\":\"WATERBODY_CODE\"->\"WATERBODY\":\"WATERBODY_CODE\" [id=\"SITE_2\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>If you want to collect a single table, such as <em>BASIN</em>, you can use the following code. The <code>get_data_model()</code> function hides some of the complexity of connecting to the table through <strong>dplyr</strong>, such as establishing the schema, and makes it simple to import data into R.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">basin_df2</span> <span class="op">&lt;-</span> <span class="va">data_model</span><span class="op">$</span><span class="va">BASIN</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 2
   BASIN BASIN_NAME                      
   &lt;chr&gt; &lt;chr&gt;                           
 1 01    Lake Erie-Niagara River Basin   
 2 02    Allegheny River Basin           
 3 03    Lake Ontario &amp; Minor Tribs.     
 4 04    Genesee River Basin             
 5 05    Chemung River Basin             
 6 06    Susquehanna River Basin         
 7 07    Seneca-Oneida-Oswego River Basin
 8 08    Black River Basin               
 9 09    St. Lawrence River Basin        
10 10    Lake Champlain River Basin      
11 11    Upper Hudson River Basin        
12 12    Mohawk River Basin              
13 13    Lower Hudson River Basin        
14 14    Delaware River Basin            
15 15    Passaic-Newark (Ramapo River)   
16 16    Housatonic River Basin          
17 17    Atlantic Ocean-Long Island Sound</code></pre>
</div>
</div>
<p>Or…</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">basin_df2</span> <span class="op">&lt;-</span> <span class="va">data_model</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/pull_tbl.html">pull_tbl</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"BASIN"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 2
   BASIN BASIN_NAME                      
   &lt;chr&gt; &lt;chr&gt;                           
 1 01    Lake Erie-Niagara River Basin   
 2 02    Allegheny River Basin           
 3 03    Lake Ontario &amp; Minor Tribs.     
 4 04    Genesee River Basin             
 5 05    Chemung River Basin             
 6 06    Susquehanna River Basin         
 7 07    Seneca-Oneida-Oswego River Basin
 8 08    Black River Basin               
 9 09    St. Lawrence River Basin        
10 10    Lake Champlain River Basin      
11 11    Upper Hudson River Basin        
12 12    Mohawk River Basin              
13 13    Lower Hudson River Basin        
14 14    Delaware River Basin            
15 15    Passaic-Newark (Ramapo River)   
16 16    Housatonic River Basin          
17 17    Atlantic Ocean-Long Island Sound</code></pre>
</div>
</div>
</section></section><section id="example-queries" class="level3" data-number="3.1.5"><h3 data-number="3.1.5" class="anchored" data-anchor-id="example-queries">
<span class="header-section-number">3.1.5</span> Example Queries</h3>
<p>You cannot import all data from the WQMA Data Warehouse into the R– the connection will time out or you will crash your R session. However, there is no need to read in all data to R. With <strong>DBI</strong>, <strong>dplyr</strong>, <strong>dm</strong>, and <strong>nexus</strong> you have the ability to do the following and more within the database:</p>
<ul>
<li><p>preview data</p></li>
<li><p>filter data</p></li>
<li><p>select only the columns of interest</p></li>
<li><p>join tables together</p></li>
</ul>
<p>You should try to narrow your focus to the smallest amount of data you need for your task. Queries will return results much faster if you limit the number of rows and columns that need to be transferred from the data warehouse into R. This might mean filtering the rows by basin, waterbody, site, sampling event, project, parameter, etc. or a combination of these factors to get only the data necessary. Similarly, selecting only the tables and columns of interest will help to speed queries up.</p>
<p>If you are feeling nervous about not pulling all data in, I hope that it</p>
<p><strong>nexus</strong> is designed to work with the R-package, <a href="https://dm.cynkra.com/"><strong>dm</strong></a>. <a href="https://dm.cynkra.com/"><strong>dm</strong></a> stands for “data model” and <a href="https://dm.cynkra.com/reference/index.html">it provides a number of useful functions for working with relational data</a> and <a href="https://dm.cynkra.com/">has great documentation on how to use those functions</a> (see Tutorials, Cheatsheet, and Technical Articles on the <strong>dm</strong> website). Many of the functions are designed to both execute locally in R and to be translated into a SQL query to be executed by a relational database or data warehouse. When possible, it is recommended that you favor <strong>dm</strong> queries over <strong>dbplyr</strong>, <strong>DBI</strong>, and custom SQL queries. It is not bad to write <strong>dbplyr</strong>, <strong>DBI</strong>, and custom SQL queries, but <strong>dm</strong> provides an elegant syntax for leveraging relational data that would be very difficult and time intensive to re-implement with other tools; in other words, <strong>dm</strong> is generally more efficient because easier to write and understand.</p>
<section id="lake-sites-with-phosphorus-data-collected-in-the-last-5-years" class="level4" data-number="3.1.5.1"><h4 data-number="3.1.5.1" class="anchored" data-anchor-id="lake-sites-with-phosphorus-data-collected-in-the-last-5-years">
<span class="header-section-number">3.1.5.1</span> Lake Sites with Phosphorus Data Collected in the last 5-Years</h4>
<ol type="1">
<li>Define the time period of interest as <code>start_date</code> and <code>end_date</code>
</li>
<li>Start with the <code>data_model</code> object defined previously</li>
<li>Filter the <code>WATERBODY</code> table to only the rows where the column <code>WATERBODY_TYPE</code> is “lake”.</li>
<li>Filter the <code>PARAMETER</code> table to only the rows where the column <code>PARAMTER_NAME</code> is “phosphorus”.</li>
<li>Filter the <code>EVENT</code> table to only the rows where the column <code>EVENT_DATETIME</code> represents a date in the last 5-years.</li>
<li>In this case, we are only interested in the <code>SITE</code> table. It’s important to note that we can use the data model to perform queries on tables besides the <code>SITE</code> table that ultimately influence the rows of the <code>SITE</code> table returned.</li>
<li>In this case, we are only interested in keeping the columns associated with the site identifier, <code>SITE_CODE</code>, and the sites coordinates (<code>LATITUDE</code> and <code>LONGITUDE</code>).</li>
<li>Collects the data from the database and into R.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1</span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lubridate/man/period.html">years</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">end_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">site_remote</span> <span class="op">&lt;-</span> <span class="va">data_model</span> <span class="op">|&gt;</span> <span class="co"># 2</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_filter.html">dm_filter</a></span><span class="op">(</span></span>
<span>    WATERBODY <span class="op">=</span> <span class="va">WATERBODY_TYPE</span> <span class="op">==</span> <span class="st">"lake"</span>, <span class="co"># 3</span></span>
<span>    PARAMETER <span class="op">=</span> <span class="va">PARAMETER_NAME</span> <span class="op">==</span> <span class="st">"phosphorus"</span>, <span class="co"># 4</span></span>
<span>  EVENT <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/between.html">between</a></span><span class="op">(</span> <span class="co"># 5</span></span>
<span>    x <span class="op">=</span> <span class="va">EVENT_DATETIME</span>,</span>
<span>    left <span class="op">=</span> <span class="fu">to_date</span><span class="op">(</span><span class="va">start_date</span>, <span class="st">"YYYY-MM-DD HH24:MI:SS"</span><span class="op">)</span>,</span>
<span>    right <span class="op">=</span> <span class="fu">to_date</span><span class="op">(</span><span class="va">end_date</span>, <span class="st">"YYYY-MM-DD HH24:MI:SS"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/pull_tbl.html">pull_tbl</a></span><span class="op">(</span><span class="va">SITE</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># 6</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span> <span class="co"># 7</span></span>
<span>    <span class="va">SITE_CODE</span>,</span>
<span>    <span class="va">LATITUDE</span>,</span>
<span>    <span class="va">LONGITUDE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">site_dm</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="va">site_remote</span><span class="op">)</span> <span class="co"># 8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="site" class="level4" data-number="3.1.5.2"><h4 data-number="3.1.5.2" class="anchored" data-anchor-id="site">
<span class="header-section-number">3.1.5.2</span> Site</h4>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">site_remote</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_filter.html">dm_filter</a></span><span class="op">(</span><span class="va">data_model</span>,</span>
<span>                             SITE <span class="op">=</span> <span class="va">SITE_CODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"07-ONON-1.0"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">site_dm</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="va">site_remote</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">single_df</span> <span class="op">&lt;-</span> <span class="va">site_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span>.start <span class="op">=</span> <span class="va">RESULT</span>, .recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">EVENT_ID</span>,</span>
<span>    <span class="va">SITE_CODE</span>,</span>
<span>    <span class="va">REPLICATE</span>,</span>
<span>    <span class="va">SAMPLE_METHOD</span>,</span>
<span>    <span class="va">SAMPLE_METHOD_DESCRIPTION</span>,</span>
<span>    <span class="va">PARAMETER_NAME</span>,</span>
<span>    <span class="va">RESULT_VALUE</span>,</span>
<span>    <span class="va">UNIT</span>,</span>
<span>    <span class="va">LATITUDE</span>,</span>
<span>    <span class="va">LONGITUDE</span>,</span>
<span>    <span class="va">BASIN</span>,</span>
<span>    <span class="va">BASIN_NAME</span>,</span>
<span>    <span class="va">WATERBODY_NAME</span>,</span>
<span>    <span class="va">WATERBODY_TYPE</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,693 × 14
   EVENT_ID             SITE_CODE REPLICATE SAMPLE_METHOD SAMPLE_METHOD_DESCRI…¹
   &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;                 
 1 07-ONON-1.0_1986090… 07-ONON-… 1         survey        sample_event_info_sur…
 2 07-ONON-1.0_1986090… 07-ONON-… 1         multiprobe    unknown               
 3 07-ONON-1.0_1986090… 07-ONON-… 1         multiprobe    unknown               
 4 07-ONON-1.0_1986090… 07-ONON-… 1         multiprobe    unknown               
 5 07-ONON-1.0_1986090… 07-ONON-… 1         multiprobe    unknown               
 6 07-ONON-1.0_1986090… 07-ONON-… 1         survey        macroinvertebrate_fie…
 7 07-ONON-1.0_1986090… 07-ONON-… 1         survey        macroinvertebrate_fie…
 8 07-ONON-1.0_1986090… 07-ONON-… 1         survey        macroinvertebrate_fie…
 9 07-ONON-1.0_1986090… 07-ONON-… 1         survey        macroinvertebrate_fie…
10 07-ONON-1.0_1986090… 07-ONON-… 1         survey        macroinvertebrate_fie…
# ℹ 1,683 more rows
# ℹ abbreviated name: ¹​SAMPLE_METHOD_DESCRIPTION
# ℹ 9 more variables: PARAMETER_NAME &lt;chr&gt;, RESULT_VALUE &lt;dbl&gt;, UNIT &lt;chr&gt;,
#   LATITUDE &lt;dbl&gt;, LONGITUDE &lt;dbl&gt;, BASIN &lt;chr&gt;, BASIN_NAME &lt;chr&gt;,
#   WATERBODY_NAME &lt;chr&gt;, WATERBODY_TYPE &lt;chr&gt;</code></pre>
</div>
</div>
</section><section id="project" class="level4" data-number="3.1.5.3"><h4 data-number="3.1.5.3" class="anchored" data-anchor-id="project">
<span class="header-section-number">3.1.5.3</span> Project</h4>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">project_remote</span> <span class="op">&lt;-</span> <span class="va">data_model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_filter.html">dm_filter</a></span><span class="op">(</span>PROJECT <span class="op">=</span> <span class="va">PROJECT_TYPE</span> <span class="op">==</span> <span class="st">"RIBS Routine"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_select_tbl.html">dm_select_tbl</a></span><span class="op">(</span></span>
<span>    <span class="va">WATERBODY</span>,</span>
<span>    <span class="va">SITE</span>,</span>
<span>    <span class="va">EVENT</span>,</span>
<span>    <span class="va">SAMPLE</span>,</span>
<span>    <span class="va">RESULT</span>,</span>
<span>    <span class="va">PARAMETER</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">project_dm</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="va">project_remote</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">single_df</span> <span class="op">&lt;-</span> <span class="va">project_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span>.start <span class="op">=</span> <span class="va">RESULT</span>, .recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">EVENT_ID</span>,</span>
<span>    <span class="va">SITE_CODE</span>,</span>
<span>    <span class="va">REPLICATE</span>,</span>
<span>    <span class="va">SAMPLE_METHOD</span>,</span>
<span>    <span class="va">SAMPLE_METHOD_DESCRIPTION</span>,</span>
<span>    <span class="va">PARAMETER_NAME</span>,</span>
<span>    <span class="va">RESULT_VALUE</span>,</span>
<span>    <span class="va">UNIT</span>,</span>
<span>    <span class="va">LATITUDE</span>,</span>
<span>    <span class="va">LONGITUDE</span>,</span>
<span>    <span class="va">BASIN</span>,</span>
<span>    <span class="va">WATERBODY_NAME</span>,</span>
<span>    <span class="va">WATERBODY_TYPE</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,911 × 13
   EVENT_ID             SITE_CODE REPLICATE SAMPLE_METHOD SAMPLE_METHOD_DESCRI…¹
   &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;                 
 1 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 2 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 3 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 4 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 5 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 6 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 7 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 8 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
 9 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
10 13-ROND-9.9_2018061… 13-ROND-… 1         unknown       unknown               
# ℹ 18,901 more rows
# ℹ abbreviated name: ¹​SAMPLE_METHOD_DESCRIPTION
# ℹ 8 more variables: PARAMETER_NAME &lt;chr&gt;, RESULT_VALUE &lt;dbl&gt;, UNIT &lt;chr&gt;,
#   LATITUDE &lt;dbl&gt;, LONGITUDE &lt;dbl&gt;, BASIN &lt;chr&gt;, WATERBODY_NAME &lt;chr&gt;,
#   WATERBODY_TYPE &lt;chr&gt;</code></pre>
</div>
</div>
</section><section id="parameter" class="level4" data-number="3.1.5.4"><h4 data-number="3.1.5.4" class="anchored" data-anchor-id="parameter">
<span class="header-section-number">3.1.5.4</span> Parameter</h4>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chloride_remote</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_filter.html">dm_filter</a></span><span class="op">(</span><span class="va">data_model</span>,</span>
<span>                             PROJECT <span class="op">=</span> <span class="va">PROJECT_TYPE</span> <span class="op">==</span> <span class="st">"RIBS Routine"</span>,</span>
<span>                             PARAMETER <span class="op">=</span> <span class="va">PARAMETER_NAME</span> <span class="op">==</span> <span class="st">"chloride"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chloride_dm</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collect</a></span><span class="op">(</span><span class="va">chloride_remote</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">single_df</span> <span class="op">&lt;-</span> <span class="va">chloride_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dm/man/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span>.start <span class="op">=</span> <span class="va">RESULT</span>, .recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">EVENT_ID</span>,</span>
<span>    <span class="va">SITE_CODE</span>,</span>
<span>    <span class="va">REPLICATE</span>,</span>
<span>    <span class="va">SAMPLE_METHOD</span>,</span>
<span>    <span class="va">SAMPLE_METHOD_DESCRIPTION</span>,</span>
<span>    <span class="va">PARAMETER_NAME</span>,</span>
<span>    <span class="va">RESULT_VALUE</span>,</span>
<span>    <span class="va">UNIT</span>,</span>
<span>    <span class="va">LATITUDE</span>,</span>
<span>    <span class="va">LONGITUDE</span>,</span>
<span>    <span class="va">BASIN</span>,</span>
<span>    <span class="va">BASIN_NAME</span>,</span>
<span>    <span class="va">WATERBODY_NAME</span>,</span>
<span>    <span class="va">WATERBODY_TYPE</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 623 × 14
   EVENT_ID             SITE_CODE REPLICATE SAMPLE_METHOD SAMPLE_METHOD_DESCRI…¹
   &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;                 
 1 01-BUFF-1.7_2018041… 01-BUFF-… 1         unknown       unknown               
 2 01-BUFF-1.7_2018061… 01-BUFF-… 1         unknown       unknown               
 3 01-BUFF-1.7_2018081… 01-BUFF-… 1         unknown       unknown               
 4 01-BUFF-1.7_2018101… 01-BUFF-… 1         unknown       unknown               
 5 01-BUFF-1.7_2019041… 01-BUFF-… 1         unknown       unknown               
 6 01-BUFF-1.7_2019061… 01-BUFF-… 1         unknown       unknown               
 7 01-BUFF-1.7_2019081… 01-BUFF-… 1         unknown       unknown               
 8 01-BUFF-1.7_2019102… 01-BUFF-… 1         unknown       unknown               
 9 01-BUFF-1.7_2020042… 01-BUFF-… 1         unknown       unknown               
10 01-BUFF-1.7_2020061… 01-BUFF-… 1         unknown       unknown               
# ℹ 613 more rows
# ℹ abbreviated name: ¹​SAMPLE_METHOD_DESCRIPTION
# ℹ 9 more variables: PARAMETER_NAME &lt;chr&gt;, RESULT_VALUE &lt;dbl&gt;, UNIT &lt;chr&gt;,
#   LATITUDE &lt;dbl&gt;, LONGITUDE &lt;dbl&gt;, BASIN &lt;chr&gt;, BASIN_NAME &lt;chr&gt;,
#   WATERBODY_NAME &lt;chr&gt;, WATERBODY_TYPE &lt;chr&gt;</code></pre>
</div>
</div>
</section></section></section><section id="setup-oracle-odbc-connectionsec-odbc" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="setup-oracle-odbc-connectionsec-odbc">
<span class="header-section-number">3.2</span> Setup Oracle ODBC Connection{sec-odbc}</h2>
<section id="objective" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="objective">
<span class="header-section-number">3.2.1</span> Objective</h3>
<p>Setup an ODBC connection to the WQMA Data Warehouse.</p>
</section><section id="what-is-an-odbc" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="what-is-an-odbc">
<span class="header-section-number">3.2.2</span> What is an ODBC?</h3>
<p>ODBC stands for Open Database Connectivity and, once configured accordingly, it allows the user to connect to a database from another program, such as R.</p>
</section><section id="oracles-instant-client-odbc-driver" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="oracles-instant-client-odbc-driver">
<span class="header-section-number">3.2.3</span> Oracle’s Instant Client ODBC Driver</h3>
<blockquote class="blockquote">
<p>Oracle’s Instant Client ODBC software is a standalone package that offers the full functionality of the Oracle ODBC driver (except the Oracle service for Microsoft Transaction Server) with a simple install. –From: <a href="https://www.oracle.com/database/technologies/releasenote-odbc-ic.html" class="uri">https://www.oracle.com/database/technologies/releasenote-odbc-ic.html</a></p>
</blockquote>
<p>In other words, Oracle’s Instant Client is a set of software that needs to be installed on your computer in order for you to connect to an Oracle database.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>I don’t care what Oracle says, this is anything but simple for the average user.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I was directed to the Oracle Instant Client from <a href="https://solutions.posit.co/connections/db/databases/oracle/">Posit’s webpage on connecting to an Oracle database.</a>.</p>
</div>
</div>
</section><section id="procedure" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="procedure">
<span class="header-section-number">3.2.4</span> Procedure</h3>
<ol type="1">
<li><p>Visit <a href="https://www.oracle.com/database/technologies/releasenote-odbc-ic.html">Oracle’s Instant Client ODBC Release Notes webpage</a></p></li>
<li>
<p>Follow the instructions in Installing Oracle Instant Client ODBC/On Windows section. You must first install the Instant Client Basic package and then install the Instant Client ODBC package. I have copied and modified the text from the webpage to try and make the steps easier to follow.</p>
<ol type="1">
<li>
<p><em>“Install the Instant Client Basic or Basic Light package, as described above.”</em></p>
<ol type="1">
<li><p>Follow the instructions at the head of the page in the “<strong>Installing Oracle Instant Client Basic and Basic Lite”</strong> section, which boils down to Installing Oracle’s Instant Client from <a href="https://www.oracle.com/database/technologies/instant-client/downloads.html">here</a>.</p></li>
<li><p>Select the <strong>Instant Client for Microsoft Windows (x64)</strong>.</p></li>
<li><p>Select the most recent version of Instant Client for Microsoft Windows and a table will expand.</p></li>
<li><p>Download the Basic Package to the root of your Downloads folder. You cannot download the file directly to your C-drive (C:\).</p></li>
<li><p>Right-click on the downloaded zip file in your Downloads folder, select Extract All, browse to your C-drive (C:\), and select Extract.</p></li>
</ol>
</li>
<li>
<p><em>“Download the <a href="https://www.oracle.com/database/technologies/instant-client/downloads.html">Instant Client ODBC package</a>. Unzip it in the same directory as your Basic or Basic Light package.”</em></p>
<ol type="1">
<li><p>The ODBC package is located on the same downloads page as the Basic Package installed in step 2.1 above. If you need to navigate back to this page, follow steps in 2.1.1 - 2.1.3.</p></li>
<li><p>Scroll down until you see the ODBC Package– it is under the subheading: <strong>Development and Runtime - optional packages.</strong></p></li>
<li><p>Install the ODBC package to your Downloads folder. You cannot download the file directly to your C-drive (C:\).</p></li>
<li><p>Right-click on the downloaded zip file in your Downloads folder, select Extract All, browse to your C-drive (C:\), select the folder you created in step 2.1.5, and select Extract.</p></li>
</ol>
</li>
<li>
<p>The C-drive directory, created in step 2.1, must be put on your computers PATH.</p>
<ol type="1">
<li><p>In your Windows Search Bar, look up and open “Edit the system environmental variables.”</p></li>
<li><p>In the Advanced tab of the pop-up window, click the “Environmental Variables…” button</p></li>
<li>
<p><strong>This step requires admin-rights.</strong></p>
<ol type="1">
<li>
<p>In the “System variables” section,:</p>
<ol type="1">
<li><p>find the existing “Path” variable</p></li>
<li><p>select the “Path” row</p></li>
<li><p>click on the “Edit…” button</p></li>
</ol>
</li>
<li>
<p>In the pop-up:</p>
<ol type="1">
<li><p>Click on the “New” button</p></li>
<li><p>Click on the “Browse…” button</p></li>
<li><p>Select the C-drive path to the instant client directory created in step 2.1</p></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p><strong>This step requires admin-rights.</strong> <em>“Execute&nbsp;<code>odbc_install.exe</code>&nbsp;from the Instant Client directory.”</em></p>
<ol type="1">
<li><p>Navigate to the folder created in step 2.2.4.</p></li>
<li><p>Double-click the <em><code>odbc_install.exe.</code></em></p></li>
</ol>
</li>
</ol>
</li>
<li>
<p>Setup a 64-bit ODBC connection.</p>
<ol type="1">
<li><p>In your Windows search bar, type “ODBC Data Sources”.</p></li>
<li><p>Select the Option that ends in “64-bit”.</p></li>
<li><p>In the window that appears, select the “Add” button.</p></li>
<li><p>Select the Oracle Instant Client option (should look something like this: “Oracle in instant_client_19_19”) and click the “Finish” button. If you do not see the Oracle Instant Client Option, then your ODBC installation was not successful. Please try to install the ODBC again.</p></li>
<li>
<p>Configuration:</p>
<ol type="1">
<li><p>Data Source Name: wqma_prod</p></li>
<li><p>Description: WQMA Data Warehouse Production Version</p></li>
<li><p>TNS Service Name: WQMAP</p></li>
<li>
<p>User ID: [Enter your database User ID]</p>
<ul>
<li>Example: JDOE</li>
</ul>
</li>
<li>
<p>Click on the “Test Connection” Button, enter your database password, and click on the “OK” button. If there are no errors, you should receive a message stating “Connection successful.”</p>
<ul>
<li>If you are entering a temporary password, you will be prompted for a new password.</li>
</ul>
</li>
<li><p>Click the “OK” button in the Oracle ODBC Driver Configuration window.</p></li>
</ol>
</li>
</ol>
</li>
<li><p>Congratulations! You have successfully downloaded, installed, and configured the necessary software to connect to an Oracle database.</p></li>
</ol></section><section id="keyring-setup-optional" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="keyring-setup-optional">
<span class="header-section-number">3.2.5</span> Keyring Setup (Optional)</h3>
<p>If you do not want to enter your password each time you establish a connection, you can setup a <a href="https://keyring.r-lib.org/">keyring</a> to securely store and access your password. Again, you should <strong>NEVER</strong> type out your password in plain text.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_set</a></span><span class="op">(</span><span class="st">"your-user-name"</span>,</span>
<span>                 keyring <span class="op">=</span> <span class="st">"wqma-example"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_get</a></span><span class="op">(</span><span class="st">"your-user-name"</span>,</span>
<span>                 keyring <span class="op">=</span> <span class="st">"wqma-example"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the keyring is established, you can point to the keyring in the <code>get_connected()</code> function using the <code>kerying</code> argument and you will not need to provide your password each time you connect to the WQMA data warehouse.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">nexus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nexus/man/get_connected.html">get_connected</a></span><span class="op">(</span>username <span class="op">=</span> <span class="st">"your-user-name"</span>,</span>
<span>                            keyring <span class="op">=</span> <span class="st">"wqma-example"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Landing Page">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Landing Page</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./analytical_data_store.html" class="pagination-link" aria-label="Analytical Data Store">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Analytical Data Store</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/BWAM/bwam_analytics/edit/main/wqma_oracle_db.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/BWAM/bwam_analytics/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>